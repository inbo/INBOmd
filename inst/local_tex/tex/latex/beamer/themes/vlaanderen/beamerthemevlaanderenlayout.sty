% Copyright 2014 by Thierry Onkelinx
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/licenses/LICENSE for more details.
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemevlaanderenlayout}

% set fonts for different elements
\usetheme{Pittsburgh}
\usecolortheme[named=support.colour]{structure}

\setbeamercolor{title}{fg=white}
\setbeamerfont{title}{size = \titlefontsize, series = \bfseries}

\setbeamercolor{subtitle}{fg=white}
\setbeamerfont{subtitle}{size = \subtitlefontsize, series = \bfseries}

\setbeamerfont{frametitle}{series = \bfseries, size = \large}
\setbeamercolor{frametitle}{bg=,fg=frametitle.colour}

\setbeamercolor{author}{fg=white}
\setbeamerfont{author}{size = \authorfontsize}

\setbeamercolor{date}{fg=white}
\setbeamerfont{date}{size = \datefontsize}

\setbeamercolor{institute}{fg=white}
\setbeamerfont{institute}{size = \institutefontsize}

\setbeamerfont{sidebar}{size = \websitefontsize, series = \bfseries}
\setbeamercolor{sidebar}{fg = sectiontitle.colour, bg = main.colour}

\setbeamerfont{section title}{size = \sectionfontsize, series = \bfseries}
\setbeamercolor{section title}{fg = sectiontitle.colour, bg =}

\setbeamerfont{subsection title}{size = \subsectionfontsize, series = \bfseries}
\setbeamercolor{subsection title}{fg = sectiontitle.colour, bg = }

\setbeamerfont{section in toc}{size = \normalsize, series = \normalfont}
\setbeamercolor{section in toc}{fg = link.colour}
\setbeamertemplate{section in toc}[square]

\setbeamerfont{subsection in toc}{size = \small, series = \normalfont}
\setbeamercolor{subsection in toc}{fg = link.colour}
\setbeamertemplate{subsection in toc}[square]

\setbeamertemplate{itemize items}[triangle]
\setbeamertemplate{enumerate items}[square]

\setbeamercolor{block title}{fg=box.colour.title, bg=box.colour}
\setbeamercolor{block body}{bg = box.colour.body, fg = box.colour.fg}
\setbeamerfont{block title}{series = \bfseries}

\setbeamercolor{block title alerted}{fg=alert.colour.title, bg=alert.colour}
\setbeamercolor{block body alerted}{bg = alert.colour.body, fg = alert.colour.fg}
\setbeamerfont{block title alerted}{series = \bfseries}

\setbeamercolor{block title example}{fg=example.colour.title, bg=example.colour}
\setbeamercolor{block body example}{bg = example.colour.body, fg = example.colour.fg}
\setbeamerfont{block title example}{series = \bfseries}

\setbeamercolor{title in head/foot}{fg=frametitle.colour}

% define title page
\setbeamertemplate{title page}{
  \begin{textblock*}{\dimexpr\paperwidth-3.5mm\relax}(3.5mm, 0mm)
    \readcover{\@coverhorizontal}{\@cover}
    \begin{pgftranslate}{\pgfpoint{\@coverhoffset}{\@coveroffset}}
      \pgfuseimage{afbeelding}
    \end{pgftranslate}
  \end{textblock*}

  \begin{textblock*}{\dimexpr\paperwidth-13.5mm\relax}(3.5mm, \dimexpr0.74\paperheight\relax)
    \hfill \showtitlelogo{\@slidelogo}%
  \end{textblock*}

 \begin{textblock}{3.5}(0, 0)
    \begin{pgfpicture}{0cm}{0cm}{3.5mm}{\pdfpageheight}
      \color{main.colour}
      \pgfrect[fill]{\pgfpoint{0mm}{0mm}}{\pgfpoint{3.5mm}{\pdfpageheight}}
    \end{pgfpicture}
  \end{textblock}

  \begin{textblock}{2.9}(1.2, 78)
    {\usebeamerfont{sidebar}\usebeamercolor[fg]{sidebar}\rotatebox{90}{\@website}}
  \end{textblock}

  \begin{textblock}{84}(18.1, 6)
    \begin{minipage}[b][50mm][b]{78mm}
      \noindent
      \raggedright
      {\usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle}\\
      {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle}
    \end{minipage}
  \end{textblock}

  \begin{textblock}{104}(18.1, 58.1)
     {\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate}~\\
     \vspace{5mm}
     \raggedright {\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor}

     {\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute}
  \end{textblock}

  \titlelogo
}

% define frames

\setbeamertemplate{frametitle}{
  \vspace{3mm}\raggedright {\usebeamerfont{frametitle}\usebeamercolor[fg]{frametitle}\insertframetitle}

  {\small \insertframesubtitle}
}

\setbeamertemplate{sidebar left}{
  \sidebarlogo
  \hfill
  \showslidelogo{\@slidelogo}

  \begin{textblock}{4}(0, 0)
    \begin{pgfpicture}{0cm}{0cm}{3.5mm}{\pdfpageheight}
      \color{main.colour}
      \pgfrect[fill]{\pgfpoint{0mm}{0mm}}{\pgfpoint{4.1mm}{\pdfpageheight}}
    \end{pgfpicture}
  \end{textblock}

  \begin{textblock}{2.9}(1.2, 78)
    \textblockcolour{}
    {\usebeamerfont{sidebar}\usebeamercolor[fg]{sidebar}\rotatebox{90}{\@website}}
  \end{textblock}

}


% define section
\newlength{\trapeziumwidth}
\setlength{\trapeziumwidth}{\dimexpr\paperwidth-8mm\relax}
\newlength{\trapeziumheight}
\setlength{\trapeziumheight}{\dimexpr\paperheight-8mm\relax}
\newlength{\trapeziumtopwidth}
\setlength{\trapeziumtopwidth}{\dimexpr\trapeziumwidth - 0.285\trapeziumheight\relax}

\newcommand{\trapezium}{
  \begin{textblock*}{\trapeziumwidth}(4mm, 4mm)
    \begin{pgfpicture}{0cm}{0cm}{\trapeziumwidth}{\trapeziumheight}
      \pgfmoveto{\pgfpoint{0mm}{0mm}}
      \pgflineto{\pgfpoint{0mm}{\trapeziumheight}}
      \pgflineto{\pgfpoint{\trapeziumtopwidth}{\trapeziumheight}}
      \pgflineto{\pgfpoint{\trapeziumwidth}{0mm}}
      \pgfclip
      \color{main.colour}
     \pgfrect[fill]{\pgfpoint{0mm}{0mm}}{\pgfpoint{\trapeziumwidth}{\trapeziumheight}}
    \end{pgfpicture}
  \end{textblock*}
}

\setbeamertemplate{section page}{
  \trapezium
  \sectionlogo

  \begin{textblock}{66}(36, 32)
    \textblockcolour{}
    \begin{minipage}[b][29mm][b]{\dimexpr\paperwidth-65mm\relax}
      \usebeamerfont{section title}\usebeamercolor[fg]{section title}
      \hypersetup{hidelinks}%
      \raggedright{
        \noindent
        \insertsection
      }%
    \end{minipage}
  \end{textblock}

  \begin{textblock}{2.9}(1.2, 78)
    \textblockcolour{}
    {\usebeamerfont{sidebar}\usebeamercolor[fg]{frametitle}\rotatebox{90}{\@website}}
  \end{textblock}
}

% define subsection

\setbeamertemplate{subsection page}{
  \trapezium

  \sectionlogo

  \begin{textblock}{66}(36, 32)
    \textblockcolour{}
    \begin{minipage}[b][29mm][b]{\dimexpr\paperwidth-65mm\relax}
      \usebeamerfont{section title}\usebeamercolor[fg]{section title}
      \hypersetup{hidelinks}%
      \raggedright{
        \noindent
        \insertsection
      }%
    \end{minipage}
  \end{textblock}

  \begin{textblock*}{\dimexpr\paperwidth-50mm\relax}(36mm, 63mm)
    \textblockcolour{}
    \hypersetup{hidelinks}%
    {\usebeamerfont{subsection title}\usebeamercolor[fg]{subsection title}\insertsubsection}
  \end{textblock*}

  \begin{textblock}{2.9}(1.2, 78)
    \textblockcolour{}
    {\usebeamerfont{sidebar}\usebeamercolor[fg]{frametitle}\rotatebox{90}{\@website}}
  \end{textblock}
}

\setbeamertemplate{block begin}{
  \vskip2mm
  \begin{beamercolorbox}[leftskip = 10mm, colsep = 1mm]{block title}%
    \usebeamerfont*{block title}\insertblocktitle
  \end{beamercolorbox}%
  \vskip-0.5mm
  \usebeamerfont{block body}%
  \begin{beamercolorbox}[vmode, colsep = 1mm]{block body}%
    \ifbeamercolorempty[bg]{block body}{\vskip-.25ex}{\vskip-.75ex}\vbox{}%
  }
  \setbeamertemplate{block end}{
  \end{beamercolorbox}
}

\setbeamertemplate{block example begin}{
  \vskip2mm
  \begin{beamercolorbox}[leftskip = 10mm, colsep = 1mm]{block title example}%
    \usebeamerfont*{block title example}\insertblocktitle
  \end{beamercolorbox}%
  \vskip-0.5mm
  \usebeamerfont{block body example}%
  \begin{beamercolorbox}[vmode, colsep = 1mm]{block body example}%
    \ifbeamercolorempty[bg]{block body example}{\vskip-.25ex}{\vskip-.75ex}\vbox{}%
  }
  \setbeamertemplate{block example end}{
  \end{beamercolorbox}
}

\setbeamertemplate{block alerted begin}{
  \vskip2mm
  \begin{beamercolorbox}[leftskip = 10mm, colsep = 1mm]{block title alerted}%
    \usebeamerfont*{block title alerted}\insertblocktitle
  \end{beamercolorbox}%
  \vskip-0.5mm
  \usebeamerfont{block body alerted}%
  \begin{beamercolorbox}[vmode, colsep = 1mm]{block body alerted}%
    \ifbeamercolorempty[bg]{block body alerted}{\vskip-.25ex}{\vskip-.75ex}\vbox{}%
  }
  \setbeamertemplate{block alerted end}{
  \end{beamercolorbox}
}

\setbeamertemplate{navigation symbols}{}

\patchcmd{\beamer@calculateheadfoot}{\advance\footheight by 4pt}{\advance\footheight by 22pt}{}{}
\setbeamertemplate{footline}[frame number]

\setbeamersize{text margin left=9.5mm}
\setbeamersize{text margin right=6mm}

\setbeamercolor{alerted text}{fg=alert.colour.body}
